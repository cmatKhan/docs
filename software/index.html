<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>Software - High Throughput Computing Facility @ CGSSB</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<meta name="generator" content="mkdocs-1.3.0, mkdocs-gitbook-1.0.7">

<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta rel="next" href="" />
<link href="../css/style.min.css" rel="stylesheet">
<link href="../stylesheets/extra.css" rel="stylesheet"> 
</head>

<body>
<div class="book">
<div class="book-summary">
<div id="book-search-input" role="search">
<input type="text" placeholder="Type to search" />
</div> <!-- end of book-search-input -->

<nav role="navigation">
<ul class="summary">
<li>
<a href=".." target="_blank" class="custom-link">High Throughput Computing Facility @ CGSSB</a>
</li>
<li class="divider"></li>
<li class="chapter" data-path="">
<a href="..">The HTCF</a>
<li class="header">Doing Work</li>

<li>
<a href="../getstarted/" class="">Getting Started</a>
</li>

<li>
<a href="../runningjobs/" class="">Running Jobs</a>
</li>

<li>
<a href="../using/queue/" class="">The Queue</a>
</li>

<li>
<a href="../using/" class="">Using the HTCF</a>
</li>

<li>
<a href="../using/batch/" class="">Batch Jobs</a>
</li>

<li>
<a href="../using/interactive/" class="">Interactive Jobs</a>
</li>

<li>
<a href="../using/accounting/" class="">Job Accounting</a>
</li>

<li class="chapter" data-path="policies/">
<a href="../policies/">Policies</a>
<li class="header">Storage</li>

<li>
<a href="../storage/" class="">Overview</a>
</li>

<li>
<a href="../storage/hts/" class="">HTS</a>
</li>

<li>
<a href="../storage/ref/" class="">REF</a>
</li>

<li>
<a href="../storage/lts/" class="">LTS</a>
</li>

<li>
<a href="../storage/ltos/" class="">LTOS</a>
</li>

<li>
<a href="../storage/new_index.md" class="">Beta</a>
</li>

<li class="chapter active" data-path="software/">
<a href="./">Software</a>
<li class="divider"></li>



<li><a href="http://www.mkdocs.org">
Published with MkDocs
</a></li>

<li><a href="https://github.com/GitbookIO/theme-default">
Theme by GitBook
</a></li>
</ul>

</nav>

</div> <!-- end of book-summary -->

<div class="book-body">
<div class="body-inner">
<div class="book-header" role="navigation">

<!-- Title -->
<h1>
<i class="fa fa-circle-o-notch fa-spin"></i>
<a href="." ></a>
</h1>

</div> <!-- end of book-header -->

<div class="page-wrapper" tabindex="-1" role="main">
<div class="page-inner">
<div id="book-search-results">
<div class="search-noresults">

<section class="normal markdown-section">



<h1 id="software-on-the-htcf">Software on the HTCF</h1>
<p>Software-wise, the HTCF starts as a blank slate for each lab.  However, this doesn't mean labs can't get up and running in a matter of minutes.</p>
<p>Each lab has its own dedicated space to install and manage software.  This <a href="../storage/ref/">reference space</a> is located in <a href="../storage/ref/#software"><code>/ref/&lt;lab&gt;/software</code></a>.</p>
<h2 id="self-service-installation">Self-service Installation</h2>
<p>Software building and installation on the HTCF is primarily self-service.</p>
<p>Labs are free to use their <a href="../storage/ref/">/ref software</a> directory to install software using whatever means is most comfortable.</p>
<p>At the lab level, <strong>use of <a href="#spack">Spack</a> to install common software is encouraged</strong>.  Virtual environments can also be used if the software is well suited.</p>
<h3 id="spack">Spack</h3>
<p><a href="https://spack.readthedocs.io">Spack</a> is a package management tool designed to support multiple versions and configurations of software on a wide variety of platforms and environments.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Installation of software on the login node is unsupported.  Please build/install software from an interactive job.</p>
</div>
<h4 id="tutorial">Tutorial</h4>
<p>See <a href="https://spack-tutorial.readthedocs.io/en/latest/">the official spack tutorial</a></p>
<h4 id="spack-initialization">Spack Initialization</h4>
<p>To create a lab instance of the spack package manager:</p>
<ol>
<li>
<p>Download and untar <a href="https://github.com/spack/spack/releases">a spack release</a> into <code>/ref/&lt;lab_name&gt;/software</code></p>
</li>
<li>
<p>Rename (or make a symlink from) <code>/ref/&lt;lab_name&gt;/software/spack-VERSION</code> to <code>/ref/&lt;lab_name&gt;/software/spack</code>.</p>
</li>
<li>
<p>Logout and log back in.  This will ensure the spack command is available in the PATH.</p>
</li>
</ol>
<h4 id="install-software-using-spack">Install Software Using Spack</h4>
<p>see <a href="https://spack.readthedocs.io/en/latest/basic_usage.html#cmd-spack-install">the official spack documentation</a></p>
<h4 id="using-software-built-by-spack-ie-preparing-the-environment">Using software built by spack (ie. preparing the environment)</h4>
<p>Once spack has built software, the bash shell needs to have the proper environment variables set to access the software.
This is accomplished using the <code>spack load</code> command.</p>
<h4 id="using-spack-to-set-the-environment">Using spack to set the environment</h4>
<p>Spack packages can be "loaded" similar to the way modules are loaded.</p>
<p>Given a <a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">spec</a>, a spack command can be used to generate the appropriate environment variables to "load" spack-installed software.</p>
<p>To view the environment variables that would be set:</p>
<div class="highlight"><pre><span></span><code>$ spack load --sh &lt;spec&gt;
</code></pre></div>
<p>To actually set the environment varibles:</p>
<div class="highlight"><pre><span></span><code>$ eval $( spack load --sh &lt;spec&gt; )
</code></pre></div>
<p>This command is similar in function to the older <code>module load &lt;spec&gt;</code> commands.</p>
<p>See <a href="https://spack.readthedocs.io/en/latest/basic_usage.html#specs-dependencies">the official spack documentation</a> for more information on specs.</p>
<p>These commands can be placed in an sbatch file to be used in a job.</p>
<div class="highlight"><pre><span></span><code>#!/bin/bash

eval $( spack load --sh &lt;spec&gt; )
</code></pre></div>
<h4 id="example-install-biom-format">Example: install biom-format</h4>
<div class="highlight"><pre><span></span><code>$ spack list biom
==&gt; 7 packages.
microbiomeutil  py-biomine    r-biomart   r-biomformat
py-biom-format  r-biom-utils  r-biomartr

$ spack versions py-biom-format
==&gt; Safe versions (already checksummed):
  2.1.10  2.1.9  2.1.7  2.1.6
...

$ spack install py-biom-format@2.1.10
...

$ eval $( spack load --sh py-biom-format@2.1.10 )
</code></pre></div>
<h4 id="what-if-the-software-i-want-is-not-available-through-spack">What if the software I want is not available through Spack</h4>
<p>When needed software is not readily accessible via Spack, there are a few options.</p>
<ol>
<li>
<p><strong>Follow the installation instructions from the software creator.</strong></p>
<p>Sometimes, this can be very quick and straightforward.</p>
<p>Sometimes, this can be very painful.</p>
<p>Sometimes, it can be a good idea to pass judgement on the quality of software based on the quality of the installation process and documentation. <img alt="ðŸ˜‰" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/1f609.svg" title=":wink:" /></p>
</li>
<li>
<p><strong>Create a custom spack package</strong></p>
</li>
</ol>
<p>Spack can be a wonderful tool for creating and maintaining software. <a href="https://spack.readthedocs.io/en/latest/packaging_guide.html">Plenty of documentation is provided for creating and maintaining custom packages</a>, though a firm understanding of python is needed.</p>
<h5 id="creating">Creating</h5>
<p>The best explanation of creating and using python virtual environments can be found <a href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment">in the official documentation</a></p>
<h4 id="r-considerations">R considerations</h4>
<h3 id="manual-installation">Manual Installation</h3>
<p>Sometimes it's just easier to follow the installation steps provided by software creator.</p>
<p>If the software depends on other software, it might be that the dependency software could be installed via <a href="#spack">spack</a>.</p>
<p>For example, if a piece of software is not available via Spack, but requires samtools to be installed:</p>
<div class="highlight"><pre><span></span><code># Install samtools via spack
$ spack install samtools

# load samtools before installation
$ eval $( spack load --sh samtools )

(proceed with the manual installation)
</code></pre></div>
<div class="admonition remember">
<p class="admonition-title">Remember</p>
<p>The best place to install software is your <a href="../storage/ref/">reference storage</a> <code>/ref/lab/sofware</code>.</p>
</div>
<p>After manual software installation, it's good practice to then create a <a href="#manual-module-files">module file</a></p>
<h4 id="manual-module-files">Manual module files</h4>
<p>Module files that are manually created go in your <a href="../storage/ref/">reference storage</a> in <code>/ref/&lt;lab&gt;/software/modules</code>.</p>
<p><a href="https://lmod.readthedocs.io/en/latest/015_writing_modules.html">The lmod documentation</a> is the best place to learn about creating module files.</p>


</section>
</div> <!-- end of search-noresults -->
<div class="search-results">
<div class="has-results">

<h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
<ul class="search-results-list"></ul>

</div> <!-- end of has-results -->
<div class="no-results">

<h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>

</div> <!-- end of no-results -->
</div> <!-- end of search-results -->
</div> <!-- end of book-search-results -->

</div> <!-- end of page-inner -->
</div> <!-- end of page-wrapper -->

</div> <!-- end of body-inner -->

</div> <!-- end of book-body -->
<script src="../js/main.js"></script>
<script src="../search/main.js"></script>
<script src="../js/gitbook.min.js"></script>
<script src="../js/theme.min.js"></script>
</body>
</html>